% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/HelperFunctions.R
\name{testProfitParticipation}
\alias{testProfitParticipation}
\title{Test profit participation values against reference data}
\usage{
testProfitParticipation(
  contract = NULL,
  tolerance = 0.01,
  path = "RefValues.xlsx",
  sheet = contract$tarif$name,
  scenario = "default",
  ...
)
}
\arguments{
\item{contract}{Optional \code{InsuranceContract} object. If not supplied,
a new contract is constructed by calling \code{InsuranceContract$new(...)}
with any additional arguments passed via \code{...}.}

\item{tolerance}{Numeric scalar giving the absolute tolerance allowed
for value comparisons (see \code{\link[=expect_equal_abs]{expect_equal_abs()}}). Default: \code{0.01}.}

\item{path}{Character string giving the path to the Excel file containing
reference values. Default: \code{"RefValues.xlsx"}.}

\item{sheet}{Character string giving the sheet name within the Excel file.
Defaults to \code{contract$tarif$name}.}

\item{scenario}{Character string identifying the profit scenario within
the contract. Defaults to \code{"default"}. If \code{NULL}, a new scenario
ID such as \code{"Scenario1"}, \code{"Scenario2"}, ... is automatically
generated. If the scenario does not yet exist, it is created by calling
\code{contract$addProfitScenario(scenario, ...)}.}

\item{...}{Additional arguments forwarded to
\code{InsuranceContract$new()}, \code{contract$addProfitScenario()}, or
\code{\link[readxl:read_excel]{readxl::read_excel()}} as appropriate.}
}
\value{
Invisibly returns \code{contract}. The function is primarily used
for validation inside testthat test suites; each column comparison
generates a \code{testthat} expectation.
}
\description{
Compares the calculated profit participation values in an
\code{InsuranceContract} object with reference values (typically read from
an Excel sheet). The comparison is column-wise and uses
\code{\link[=expect_equal_abs]{expect_equal_abs()}} to allow for small numeric deviations.
}
\details{
The function performs the following steps:
\enumerate{
\item If no contract is provided, creates one using the supplied tariff
parameters via \code{InsuranceContract$new(...)}.
\item If \code{scenario} is missing or not yet present in
\code{contract$Values$profitScenarios}, generates or adds it.
\item Reads reference data from the specified Excel sheet using
\code{\link[readxl:read_excel]{readxl::read_excel()}}.
\item For each column present in both the reference data and the
scenario matrix, compares corresponding numeric values using
\code{\link[=expect_equal_abs]{expect_equal_abs()}}, with the specified tolerance.
}

Columns not present in both datasets are ignored. Missing or malformed
scenario matrices trigger a warning (to be implemented).
}
\examples{
\dontrun{
# Compare profit participation results to reference values
testProfitParticipation(
  contract = my_contract,
  path = system.file("extdata", "RefValues.xlsx", package = "LifeInsureR"),
  sheet = "Tariff12",
  scenario = "Scenario1",
  tolerance = 0.001
)

# Create and test a new contract on the fly
testProfitParticipation(
  tariff = "GB",
  startAge = 30,
  sumInsured = 100000,
  path = "RefValues.xlsx"
)
}

}
\seealso{
\code{\link[=expect_equal_abs]{expect_equal_abs()}}, \code{\link[readxl:read_excel]{readxl::read_excel()}},
\code{\link[testthat:equality-expectations]{testthat::expect_equal()}}
}
